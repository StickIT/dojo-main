!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.seeThru=e()}(this,function(){function t(t,e){var i,n=document.createElement("canvas"),a=n.getContext("2d");n.width=e.width,n.height=e.height,a.drawImage(t,0,0,e.width,e.height),i=a.getImageData(0,0,e.width,e.height);for(var r=3,o=i.data.length;r<o;r+=4)i.data[r-1]=i.data[r-2]=i.data[r-3]=i.data[r],i.data[r]=255;return i}function e(t,e){for(var i=3,n=t.data.length;i<n;i+=4)t.data[i]=e[i-1],t.data[i-3]=t.data[i-3]/(e[i-1]?e[i-1]/255:1),t.data[i-2]=t.data[i-2]/(e[i-1]?e[i-1]/255:1),t.data[i-1]=t.data[i-1]/(e[i-1]?e[i-1]/255:1);return t}function i(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length;i++)if(window[e[i]+"RequestAnimationFrame"])return window[e[i]+"RequestAnimationFrame"];return function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),a=window.setTimeout(function(){e(i+n)},n);return t=i+n,a}}function n(){for(var t=["ms","moz","webkit","o"],e=0;e<t.length;e++){if(window[t[e]+"CancelAnimationFrame"])return window[t[e]+"CancelAnimationFrame"];if(window[t[e]+"CancelRequestAnimationFrame"])return window[t[e]+"CancelRequestAnimationFrame"]}return function(t){clearTimeout(t)}}function a(t){return[].slice.call(t)}function r(t){return Object.prototype.toString.call(t)}function o(t,e){e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)}function h(t){return t.tagName?t:"[object String]"===r(t)?document.querySelector(t):t.length?t[0]:null}function s(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i+": "+t[i]+";");return e.join("")}function u(t){t.fn&&!t.fn.seeThru&&(t.fn.seeThru=function(){var e=a(arguments);return this.each(function(){var i=t(this);if(!e.length||1===e.length&&"[object Object]"===r(e[0])){if(i.data("seeThru"))return;i.data("seeThru",new l(this,e[0])._init())}else if(e.length&&"[object String]"===r(e[0])){if(!i.data("seeThru"))return;i.data("seeThru").ready(function(){i.data("seeThru")[e[0]](e[1]),"revert"===e[0]&&i.data("seeThru",null)})}})})}function d(){var t=[];this.push=function(e){return e?(t.push(e),e):null},this.has=function(e){return t.some(function(t){return t===e})},this.remove=function(e){t=t.filter(function(t){return t!==e})}}function c(a,r){var u,d,c,l=r.mask?1:2,g={width:parseInt(r.width,10),height:parseInt(r.height,10)},f=document.createElement("canvas"),v=f.getContext("2d"),m=document.createElement("canvas"),w=m.getContext("2d"),p=window.requestAnimationFrame||i(),_=window.cancelAnimationFrame||n(),y=function(t){var i,n,o,h;for(v.drawImage(a,0,0,g.width,g.height*l),i=v.getImageData(0,0,g.width,g.height),n=v.getImageData(0,g.height,g.width,g.height).data,r.unmult&&e(i,n),o=3,h=i.data.length;o<h;o+=4)i.data[o]=r.alphaMask?n[o-1]:Math.max(n[o-1],n[o-2],n[o-3]);w.putImageData(i,0,0,0,0,g.width,g.height),t&&(c=p(function(){y(!0)}))},b=function(e){if("IMG"!==e.tagName)throw new Error("Cannot use non-image element as mask!");e.width=g.width,e.height=g.height,r.alphaMask?v.putImageData(t(e,g),0,g.height):v.drawImage(e,0,g.height,g.width,g.height),e.style.display="none"};this.startRendering=function(){return y(!0),this},this.stopRendering=function(){return _(c),this},this.teardown=function(){return _(c),a.parentNode.removeChild(a.nextSibling),a.parentNode.removeChild(a.nextSibling),a.style.display=u,this},this.updateMask=function(t){return b(t),this},this.getCanvas=function(){return m},this.getPoster=function(){return d};var T=a.getBoundingClientRect();g.height&&g.width||(a.width||a.height?a.height?a.width?(g.width=g.width||T.width,g.height=g.height||T.height/l):(g.width=g.width||T.height*(a.videoWidth/Math.floor(a.videoHeight/l)),g.height=g.height||T.height):(g.width=g.width||T.width,g.height=g.height||T.width/(a.videoWidth/Math.floor(a.videoHeight/l))):(g.width=g.width||a.videoWidth,g.height=g.height||a.videoHeight/l)),f.width=g.width,f.height=2*g.height,f.style.display="none",f.className="seeThru-buffer",m.width=g.width,m.height=g.height,m.className="seeThru-display",o(f,a),o(m,a),r.mask&&b(h(r.mask)),r.poster&&a.poster&&(d=document.createElement("div"),d.className="seeThru-poster",d.style.cssText=s({width:g.width+"px",height:g.height+"px",position:"absolute",top:0,left:0,backgroundSize:"cover",backgroundPosition:"center",backgroundImage:'url("'+a.poster+'")'}),o(d,a)),u=window.getComputedStyle(a).display,a.style.display="none","autoplay"===r.start&&a.play()}function l(t,e){var i=this,n=!1,a=[],r={start:"autoplay",end:"loop",mask:!1,alphaMask:!1,width:null,height:null,poster:!1,unmult:!1},o=function(){try{return new Event("submit",{bubbles:!1}).bubbles===!1&&new Event("submit",{bubbles:!0}).bubbles===!0}catch(t){return!1}}(),s=["mouseenter","mouseleave","click","mousedown","mouseup","mousemove","mouseover","hover","dblclick","contextmenu","focus","blur"];if(e=e||{},this._video=h(t),!this._video||"VIDEO"!==this._video.tagName)throw new Error("Could not use specified source");this._options=function(t){for(var e in r)r.hasOwnProperty(e)&&(e in t||(t[e]=r[e]));return t}(e),this._init=function(){var t=function(){function t(){i._video.play(),i._options.poster?i._seeThru.getPoster().removeEventListener("click",t):i._seeThru.getCanvas().removeEventListener("click",t)}if(g.has(this._video))throw new Error("seeThru already initialized on passed video element!");this._seeThru=new c(this._video,this._options),"clicktoplay"===this._options.start?this._options.poster?this._seeThru.getPoster().addEventListener("click",t):this._seeThru.getCanvas().addEventListener("click",t):"autoplay"===this._options.start&&e.poster&&(this._seeThru.getPoster().style.display="none"),"rewind"===this._options.end?this._video.addEventListener("ended",function(){i._video.currentTime=0,i._seeThru.getCanvas().addEventListener("click",t)}):"stop"!==this._options.end&&this._video.addEventListener("ended",function(){i._video.currentTime=0,i._video.play()}),this._options.poster&&this._video.poster&&(this._video.addEventListener("play",function(){i._seeThru.getPoster().style.display="none"}),this._video.addEventListener("pause",function(){i._seeThru.getPoster().style.display="block"})),s.forEach(function(t){i._seeThru.getCanvas().addEventListener(t,function(){var e;o?e=new Event(t):(e=document.createEvent("Event"),e.initEvent(t,!0,!0)),i._video.dispatchEvent(e)})}),this._seeThru.startRendering(),n=!0,g.push(this._video),a.forEach(function(t){t(i,i._video,i.getCanvas())})}.bind(this);return this._video.readyState>0?t():this._video.addEventListener("loadedmetadata",function(){t()}),this},this.getCanvas=function(){return this._seeThru.getCanvas()},this.play=function(){return this._video.play(),this},this.pause=function(){return this._video.pause(),this},this.revert=function(){this._seeThru.teardown(),g.remove(this._video)},this.updateMask=function(t){return this._seeThru.updateMask(h(t)),this},this.ready=function(t){return n?setTimeout(function(){t(i,i._video,i.getCanvas())},0):a.push(t),this}}window.jQuery&&u(window.jQuery);var g=new d;return{create:function(t,e){return new l(t,e)._init()},attach:u}});